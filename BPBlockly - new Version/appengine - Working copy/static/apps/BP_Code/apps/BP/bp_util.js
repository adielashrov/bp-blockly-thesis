/**
 * Static function which extracts address  'ver' variable.
 */
var getUrlVars = function() {
    var vars = {};
    var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m, key, value) {
        vars[key] = value;
    });
    return vars;
};

tVersion = getUrlVars()["ver"];

tTestCase = getUrlVars()["test"];

//Initializing the version variable according to the version get variable.
if (tVersion == "1") {
    document.write('<script type="text/javascript" src="template.js"></script>');
} else if (tVersion == "2") {
    document.write('<script type="text/javascript" src="template2.js"></script>');
} else {
    tVersion = "1";
    document.write('<script type="text/javascript" src="template.js"></script>');
}

//Initializing the test-case variable according to the test-case get variable.
if(typeof tTestCase == 'undefined'){
	tTestCase = "0";
}


//TODO: Rename this file name.
/**----------------------------------------------------------------------------------------------------------------------
* ---------------------------------------------BP Code versionController  - subclass of versionController------------
-----------------------------------------------------------------------------------------------------------------------*/
function versionControllerCode() {
    this.project = null;
};

//TODO:Clean the commented blocks and project blocks.
versionControllerCode.prototype.initProject = function() {
    if ((typeof tVersion == 'undefined') || (tVersion == "1")) {
        this.project = {

            blocks: '<xml xmlns="http://www.w3.org/1999/xhtml"><block type="bp_repeat_forever" x="83" y="-854"><statement name="DO"><block type="scoped_wait" inline="false"><value name="WAIT-FOR"><block type="ballHitsBrick"><title name="menu">\'wideEdgeCollisionOfBallAndBrick\'</title></block></value><next><block type="scoped_request" inline="false"><value name="REQUEST"><block type="reverse_direction"><title name="menu">\'reverseBallYDirection\'</title></block></value></block></next></block></statement></block><block type="bp_repeat_forever" x="465" y="-840"><statement name="DO"><block type="scoped_wait" inline="false"><value name="WAIT-FOR"><block type="key_pressed"><title name="dropdown">\'keydown-32\'</title></block></value><next><block type="scoped_request" inline="false"><value name="REQUEST"><block type="startGame"></block></value></block></next></block></statement></block><block type="bp_repeat_forever" x="832" y="-832"><statement name="DO"><block type="scoped_wait" inline="false"><value name="WAIT-FOR"><block type="key_pressed"><title name="dropdown">\'keydown-37\'</title></block></value><next><block type="scoped_request" inline="false"><value name="REQUEST"><block type="acceleratePad"><title name="menu">\'acceleratePadLeft\'</title></block></value><next><block type="scoped_request" inline="false"><value name="REQUEST"><block type="acceleratePad"><title name="menu">\'acceleratePadLeft\'</title></block></value></block></next></block></next></block></statement></block><block type="bp_repeat_forever" x="79" y="-712"><statement name="DO"><block type="scoped_wait" inline="false"><value name="WAIT-FOR"><block type="ballHitsBrick"><title name="menu">\'narrowEdgeCollisionOfBallAndBrick\'</title></block></value><next><block type="scoped_request" inline="false"><value name="REQUEST"><block type="reverse_direction"><title name="menu">\'reverseBallXDirection\'</title></block></value></block></next></block></statement></block><block type="bp_repeat_forever" x="470" y="-705"><statement name="DO"><block type="scoped_wait" inline="false"><value name="WAIT-FOR"><block type="ball_at"><title name="menu">\'ballAtTop\'</title></block></value><next><block type="scoped_request" inline="false"><value name="REQUEST"><block type="reverse_direction"><title name="menu">\'reverseBallYDirection\'</title></block></value></block></next></block></statement></block><block type="bp_repeat_forever" x="835" y="-688"><statement name="DO"><block type="scoped_wait" inline="false"><value name="WAIT-FOR"><block type="key_pressed"><title name="dropdown">\'keydown-39\'</title></block></value><next><block type="scoped_request" inline="false"><value name="REQUEST"><block type="acceleratePad"><title name="menu">\'acceleratePadRight\'</title></block></value><next><block type="scoped_request" inline="false"><value name="REQUEST"><block type="acceleratePad"><title name="menu">\'acceleratePadRight\'</title></block></value></block></next></block></next></block></statement></block><block type="bp_repeat_forever" x="78" y="-573"><statement name="DO"><block type="scoped_wait" inline="false"><value name="WAIT-FOR"><block type="destroyCurrentBricks"></block></value><next><block type="scoped_request" inline="false"><value name="REQUEST"><block type="increaseScore"></block></value></block></next></block></statement></block><block type="bp_repeat_forever" x="469" y="-568"><statement name="DO"><block type="scoped_wait" inline="false"><value name="WAIT-FOR"><block type="ball_at"><title name="menu">\'ballAtLeft\'</title></block></value><next><block type="scoped_request" inline="false"><value name="REQUEST"><block type="reverse_direction"><title name="menu">\'reverseBallXDirection\'</title></block></value></block></next></block></statement></block><block type="bp_repeat_forever" x="835" y="-529"><statement name="DO"><block type="scoped_wait" inline="false"><value name="WAIT-FOR"><block type="ballHitPad"></block></value><next><block type="scoped_request" inline="false"><value name="REQUEST"><block type="reverse_direction"><title name="menu">\'reverseBallYDirection\'</title></block></value><next><block type="scoped_request" inline="false"><value name="REQUEST"><block type="changeXSpeedRelativeToPad"></block></value></block></next></block></next></block></statement></block><block type="bp_repeat_forever" x="462" y="-431"><statement name="DO"><block type="scoped_wait" inline="false"><value name="WAIT-FOR"><block type="ball_at"><title name="menu">\'ballAtRight\'</title></block></value><next><block type="scoped_request" inline="false"><value name="REQUEST"><block type="reverse_direction"><title name="menu">\'reverseBallXDirection\'</title></block></value></block></next></block></statement></block><block type="bp_repeat_forever" x="835" y="-373"><statement name="DO"><block type="scoped_wait" inline="false"><value name="WAIT-FOR"><block type="ball_collides_with"><title name="menu">\'ballCollidesWithBrick\'</title></block></value><next><block type="scoped_request" inline="false"><value name="REQUEST"><block type="destroyCurrentBricks"></block></value></block></next></block></statement></block><block type="bp_repeat_forever" x="462" y="-309"><statement name="DO"><block type="scoped_wait" inline="false"><value name="WAIT-FOR"><block type="ball_at"><title name="menu">\'ballAtBottom\'</title></block></value><next><block type="scoped_request" inline="false"><value name="REQUEST"><block type="gameStatus"><title name="menu">\'gameLost\'</title></block></value></block></next></block></statement></block></xml>',
            html_text: "<!DOCTYPE HTML>\n<html lang=\"fr\">\n<head>\n    <meta charset=\"UTF-8\">\n    <script type=\"text/javascript;version=1.7\">\n\t\tfunction windowLocation() {\n\t\t\tvar tProtocol = window.location.protocol;\n\t\t\tif((tProtocol == 'http:') || (tProtocol == 'http:')) {\n\t\t\t\treturn \"web\";\n\t\t\t}\n\t\t\telse if(tProtocol == 'file:') {\n\t\t\t\treturn \"file\";\n\t\t\t}\n\t\t};\n\t</script>\n\t<script type=\"text/javascript;version=1.7\">\n\t\tif(windowLocation() == \"web\") {\n\t\t\tdocument.write(\"<link id=\\\"linkToStyle\\\" href=\\\"\\/static\\/apps\\/BP_Code\\/apps\\/BP\\/examples\\/Bricks\\/styles.css\\\" rel=\\\"stylesheet\\\">\");\n\t\t}\n\t\telse {\n\t\t\tdocument.write(\"<link id=\\\"linkToStyle\\\" href=\\\"examples\\\\Bricks\\\\styles.css\\\" rel=\\\"stylesheet\\\">\");\n\t\t}\n\t</script>\n    <title>BrikBrok - my brick breaker HTML 5</title>\n</head>\n<body>\n    <div class=\"grid\">\n        <header>\n            <h1>\n                BP BrikBrok\n\t\t\t</h1>\n            <ul>\n                <li><a href=\"#gameZone\" id=\"newGame\" style=\"margin-right:25px\">New game</a></li>\n\t\t\t\t<li style=\"display:none;\"><a href=\"#gameZone\" id=\"wormHole\" style=\"display:none;\">Wormhole Mode</a></li>\n            </ul>\n        </header>\n        <div id=\"gameZone\">\n            <canvas id=\"backgroundCanvas\">\n                Your browser doesn't support HTML5. \n            </canvas>\n            <svg id=\"svgRoot\">\n\t\t\t\t<circle cx=\"100\" cy=\"50\" r=\"10\" id=\"ball\" />\n                <rect id=\"pad\" height=\"15px\" width=\"225px\" x=\"200\" y=\"150\" rx=\"10\" ry=\"20\"/>\n            </svg>\n            <div id=\"stats\">\n            </div>\n            <div id=\"message\">Victory!</div>\n        </div>\n        <footer>\n            <div style=\"height: 50px;width=100%\">\n\t\t\t\t<div style=\"float:left; width=33%; \">\n\t\t\t\t\t<h2 style=\"margin-left:15px\">Based on a tutorial by David Catuhe</h2>\n\t\t\t\t</div>\n\t\t\t\t<div id=\"scoreDiv\" style=\"float:left; width=33%; margin-left:32%;\">\n\t\t\t\t\t<h2 id=\"scoreTextZone\" style=\"font-size: 175%; color:black;\">Score:  0 </h2>\n\t\t\t\t</div>\n\t\t\t\t<div id=\"debugTextDiv\" style=\"float:right; width=33%; margin-right:5px; \">\n\t\t\t\t\t<h2 id=\"debugTextZone\" style=\"font-size: 150%; color:grey;\">Text will appear here</h2>\n\t\t\t\t</div>\n\t\t\t\t<!--border-style:solid; border-width: 2px;-->\n\t\t\t\t<!--<div style=\"float:left;\">\n\t\t\t\t\t<h2 style=\"margin-left:15px\">Based on a tutorial by David Catuhe</h2>\n\t\t\t\t</div>\n\t\t\t\t<div id=\"scoreDiv\" style=\"float:left; margin-left:30%; height:100px; width 100px; border-style:solid; border-width: 2px;\">\n\t\t\t\t\t<h2 id=\"scoreTextZone\" style=\"float:left;font-size: 175%; color:black;\">Score: </h2>\n\t\t\t\t\t<h2 id=\"scoreTextZone2\" style=\"float:left;font-size: 175%; color:black;\"> 0 </h2>\n\t\t\t\t</div>\n\t\t\t\t<div id=\"debugTextDiv\" style=\"float:left; margin-left:35%; height:100px; \">\n\t\t\t\t\t<h2 id=\"debugTextZone\" style=\"font-size: 150%; color:grey;text-align:center;\">Debug text will appear here</h2>\n\t\t\t\t</div>-->\n\t\t\t</div>\n\t\t</footer>\n    </div>\n\t<script type=\"text/javascript;version=1.7\" src=\"/static/apps/BP_Code/apps/BP/examples/Bricks/mouse.js\"></script>\n    <script type=\"text/javascript;version=1.7\" src=\"/static/apps/BP_Code/apps/BP/examples/Bricks/background.js\"></script>\n    <script type=\"text/javascript;version=1.7\" src=\"/static/apps/BP_Code/apps/BP/examples/Bricks/game.js\"></script>\n\t<script type=\"text/javascript;version=1.7\" src=\"examples\\Bricks\\mouse.js\"></script>\n    <script type=\"text/javascript;version=1.7\" src=\"examples\\Bricks\\background.js\"></script>\n    <script type=\"text/javascript;version=1.7\" src=\"examples\\Bricks\\game.js\"></script>\n</body>\n</html>\n",
            project_blocks: "custom = {};\n\ncustom.startGame = {\n    helpUrl: '../../../../blocks_API/generic_event_help.html?event=Start_game',\n    init: function() {\n        this.setColour(230);\n        this.appendDummyInput()\n            .appendTitle(\"Start game\");\n        this.setOutput(true, 'event');\n        this.setTooltip('Start game event');\n    }\n};\n\nBlockly.JavaScript.startGame = function() {\n    return ['\"startGame\"', Blockly.JavaScript.ORDER_NONE];\n};\n//Currently not working - debug.\n/*\ncustom.initialConfiguration = {\n  //helpUrl: 'http://www.example.com/',\n  init: function() {\n    this.setColour(230);\n    this.appendDummyInput()\n        .appendTitle(\"Board of\");\n    this.appendDummyInput()\n        .appendTitle(new Blockly.FieldDropdown([[\"5*20\", \"5 20\"], [\"5*5\", \"5 5\"], [\"3*3\", \"33\"]]), \"board_size\");\n    this.appendDummyInput()\n        .appendTitle(\"with \");\n    this.appendDummyInput()\n        .appendTitle(new Blockly.FieldTextInput(\"5\"), \"num_of_red_bricks\");\n    this.appendDummyInput()\n        .appendTitle(\"red, \");\n    this.appendDummyInput()\n        .appendTitle(new Blockly.FieldTextInput(\"5\"), \"num_of_gold_bricks\");\n    this.appendDummyInput()\n        .appendTitle(\"gold, \");\n    this.appendDummyInput()\n        .appendTitle(new Blockly.FieldTextInput(\"5\"), \"num_of_green_bricks\");\n    this.appendDummyInput()\n        .appendTitle(\"green, \");\n    this.appendDummyInput()\n        .appendTitle(new Blockly.FieldTextInput(\"5\"), \"num_of_blue_bricks\");\n    this.appendDummyInput()\n        .appendTitle(\"blue, and\");\n    this.appendDummyInput()\n        .appendTitle(new Blockly.FieldTextInput(\"5\"), \"num_of_pink_bricks\");\n    this.appendDummyInput()\n    .appendTitle(\"pink bricks.\");\n    this.setInputsInline(true);\n    this.setOutput(true, 'event');\n    this.setTooltip('');\n  }\n};\n\nBlockly.JavaScript.initialConfiguration = function() {\n  var dropdown_board_size = this.getTitleValue('board_size');\n  var text_num_of_red_bricks = this.getTitleValue('num_of_red_bricks');\n  var text_num_of_gold_bricks = this.getTitleValue('num_of_gold_bricks');\n  var text_num_of_green_bricks = this.getTitleValue('num_of_green_bricks');\n  var text_num_of_blue_bricks = this.getTitleValue('num_of_blue_bricks');\n  var text_num_of_pink_bricks = this.getTitleValue('num_of_pink_bricks');\n  var code = \"\";\n  //var code =    'board_size:' + dropdown_board_size + ',' + 'num_of_red_bricks:' + text_num_of_red_bricks + ',' + 'num_of_gold_bricks:' + text_num_of_gold_bricks + ',' +  'num_of_green_bricks:' + text_num_of_green_bricks + ',' +  'num_of_blue_bricks:' + text_num_of_blue_bricks + ',' +  'num_of_pink_bricks:' + text_num_of_pink_bricks;\n  return [code, Blockly.JavaScript.ORDER_NONE];\n};\n*/\ncustom.acceleratePad = {\n    helpUrl: '../../../../blocks_API/generic_event_help.html?event=Accelerate_pad',\n    init: function() {\n        this.setColour(230);\n        this.appendDummyInput()\n            .appendTitle(\"Accelerate pad\");\n        this.appendDummyInput()\n            .appendTitle(new Blockly.FieldDropdown([\n                [\"left\", \"'acceleratePadLeft'\"],\n                [\"right\", \"'acceleratePadRight'\"]\n            ]), \"menu\");\n        this.setInputsInline(true);\n        this.setOutput(true, 'event');\n        this.setTooltip('');\n    }\n};\n\nBlockly.JavaScript.acceleratePad = function() {\n    var dropdown_menu = this.getTitleValue('menu');\n    // TODO: Assemble JavaScript into code variable.\n    var code = dropdown_menu;\n    // TODO: Change ORDER_NONE to the correct strength.\n    return [code, Blockly.JavaScript.ORDER_NONE];\n};\n\ncustom.color_brick = {\n    helpUrl: '../../../../blocks_API/generic_event_help.html?event=Color_brick',\n    init: function() {\n        this.setColour(230);\n        this.appendDummyInput()\n            .appendTitle(\"Color brick \");\n        this.appendDummyInput()\n            .appendTitle(new Blockly.FieldDropdown([\n                [\"green\", \"'colorBrickGreen'\"],\n                [\"gold\", \"'colorBrickGold'\"],\n                [\"blue\", \"'colorBrickBlue'\"],\n                [\"red\", \"'colorBrickRed'\"]\n            ]), \"menu\");\n        this.setInputsInline(true);\n        this.setOutput(true, 'event');\n        this.setTooltip('');\n    }\n};\n\nBlockly.JavaScript.color_brick = function() {\n    var dropdown_menu = this.getTitleValue('menu');\n    // TODO: Assemble JavaScript into code variable.\n    var code = dropdown_menu;\n    // TODO: Change ORDER_NONE to the correct strength.\n    return [code, Blockly.JavaScript.ORDER_NONE];\n};\n\ncustom.reverse_direction = {\n    helpUrl: '../../../../blocks_API/generic_event_help.html?event=Reverse_ball',\n    init: function() {\n        this.setColour(230);\n        this.appendDummyInput()\n            .appendTitle(\"Reverse ball\");\n        this.appendDummyInput()\n            .appendTitle(new Blockly.FieldDropdown([\n                [\"x\", \"'reverseBallXDirection'\"],\n                [\"y\", \"'reverseBallYDirection'\"]\n            ]), \"menu\");\n        this.appendDummyInput()\n            .appendTitle(\"direction\");\n        this.setInputsInline(true);\n        this.setOutput(true, \"event\");\n        this.setTooltip('');\n    }\n};\n\nBlockly.JavaScript.reverse_direction = function() {\n    var dropdown_menu = this.getTitleValue('menu');\n    // TODO: Assemble JavaScript into code variable.\n    var code = dropdown_menu;\n    // TODO: Change ORDER_NONE to the correct strength.\n    return [code, Blockly.JavaScript.ORDER_NONE];\n};\n\ncustom.destroyCurrentBricks = {\n    helpUrl: '../../../../blocks_API/generic_event_help.html?event=Destroy_brick',\n    init: function() {\n        this.setColour(230);\n        this.appendDummyInput()\n            .appendTitle(\"Destroy brick\");\n        this.setOutput(true, 'event');\n        this.setTooltip('Destroy current bricks');\n    }\n};\n\nBlockly.JavaScript.destroyCurrentBricks = function() {\n    return ['\"destroyCurrentBricks\"', Blockly.JavaScript.ORDER_NONE];\n};\n\ncustom.changeXSpeedRelativeToPad = {\n    helpUrl: '../../../../blocks_API/generic_event_help.html?event=Change_x_speed',\n    init: function() {\n        this.setColour(230);\n        this.appendDummyInput()\n            .appendTitle(\"Change x speed relative to pad\");\n        this.setOutput(true, 'event');\n        this.setTooltip('Change x speed relative to pad');\n    }\n};\n\nBlockly.JavaScript.changeXSpeedRelativeToPad = function() {\n    return ['\"changeXSpeedRelativeToPad\"', Blockly.JavaScript.ORDER_NONE];\n};\n\ncustom.increaseScore = {\n    helpUrl: '../../../../blocks_API/generic_event_help.html?event=Increase_score',\n    init: function() {\n        this.setColour(230);\n        this.appendDummyInput()\n            .appendTitle(\"Increase score\");\n        this.setOutput(true, 'event');\n        this.setTooltip('Increase score event');\n    }\n};\n\nBlockly.JavaScript.increaseScore = function() {\n    return ['\"increaseScore\"', Blockly.JavaScript.ORDER_NONE];\n};\n\ncustom.decreaseScore = {\n    helpUrl: '../../../../blocks_API/generic_event_help.html?event=Decrease_score',\n    init: function() {\n        this.setColour(230);\n        this.appendDummyInput()\n            .appendTitle(\"Decrease score\");\n        this.setOutput(true, 'event');\n        this.setTooltip('Decrease score event');\n    }\n};\n\nBlockly.JavaScript.decreaseScore = function() {\n    return ['\"decreaseScore\"', Blockly.JavaScript.ORDER_NONE];\n};\n\ncustom.initScore = {\n    helpUrl: '../../../../blocks_API/generic_event_help.html?event=Init_score',\n    init: function() {\n        this.setColour(230);\n        this.appendDummyInput()\n            .appendTitle(\"Init score\");\n        this.setOutput(true, 'event');\n        this.setTooltip('Init score event');\n    }\n};\n\nBlockly.JavaScript.initScore = function() {\n    return ['\"initScore\"', Blockly.JavaScript.ORDER_NONE];\n};\n\ncustom.gameStatus = {\n    helpUrl: '../../../../blocks_API/game_status.html',\n    init: function() {\n        this.setColour(230);\n        this.appendDummyInput()\n            .appendTitle(\"Game \");\n        this.appendDummyInput()\n            .appendTitle(new Blockly.FieldDropdown([\n                [\"lost\", \"'gameLost'\"],\n                [\"won\", \"'gameWon'\"],\n            ]), \"menu\");\n        this.setInputsInline(true);\n        this.setOutput(true, 'event');\n        this.setTooltip('');\n    }\n};\n\nBlockly.JavaScript.gameStatus = function() {\n    var dropdown_menu = this.getTitleValue('menu');\n    // TODO: Assemble JavaScript into code variable.\n    var code = dropdown_menu;\n    // TODO: Change ORDER_NONE to the correct strength.\n    return [code, Blockly.JavaScript.ORDER_NONE];\n};\n\n\ncustom.showVictoryMessage = {\n    helpUrl: '../../../../blocks_API/generic_event_help.html?event=Show_victory__message',\n    init: function() {\n        this.setColour(230);\n        this.appendDummyInput()\n            .appendTitle(\"Show victory message\");\n        this.setOutput(true, 'event');\n        this.setTooltip('Show victory message event');\n    }\n};\n\nBlockly.JavaScript.showVictoryMessage = function() {\n    return ['\"showVictoryMessage\"', Blockly.JavaScript.ORDER_NONE];\n};\n\ncustom.key_pressed = {\n    helpUrl: '../../../../blocks_API/clicked_event.html',\n    init: function() {\n        this.setColour(190);\n        this.appendDummyInput()\n            .appendTitle(\"Clicked\");\n        this.appendDummyInput()\n            .appendTitle(new Blockly.FieldDropdown([\n                [\"space\", \"'keydown-32'\"],\n                [\"key left\", \"'keydown-37'\"],\n                [\"key right\", \"'keydown-39'\"],\n                [\"key up\", \"'keydown-38'\"],\n                [\"key down\", \"'keydown-40'\"],\n                [\"enter\", \"'keydown-13'\"],\n                /*\n                [\"escape\", \"'keydown-27'\"],\n                [\"backspace\", \"'keydown-8'\"],\n                [\"ctrl\", \"'keydown-17'\"],\n                [\"alt\", \"'keydown-18'\"],\n                [\"shift\", \"'keydown-16'\"],\n                [\"caps-lock\", \"'keydown-20'\"],\n                [\"tab\", \"'keydown-9'\"],\n                [\"\\\\\", \"'keydown-220'\"],\n                [\"`\", \"'keydown-192'\"],\n                [\"[\", \"'keydown-219'\"],\n                [\"\\'\", \"'keydown-220'\"],\n                [\"]\", \"'keydown-221'\"],\n                [\";\", \"'keydown-59'\"],\n                [\",\", \"'keydown-188'\"],\n                [\".\", \"'keydown-190'\"],\n                [\"/\", \"'keydown-191'\"],\n                [\"-\", \"'keydown-173'\"],\n                [\"=\", \"'keydown-61'\"],\n                [\"=\", \"'keydown-61'\"],\n                */\n                [\"1\", \"'keydown-49'\"],\n                [\"2\", \"'keydown-50'\"],\n                [\"3\", \"'keydown-51'\"],\n                [\"4\", \"'keydown-52'\"],\n                [\"5\", \"'keydown-53'\"],\n                [\"6\", \"'keydown-54'\"],\n                [\"7\", \"'keydown-55'\"],\n                [\"8\", \"'keydown-56'\"],\n                [\"9\", \"'keydown-57'\"],\n                [\"q\", \"'keydown-81'\"],\n                [\"w\", \"'keydown-87'\"],\n                [\"e\", \"'keydown-69'\"],\n                [\"r\", \"'keydown-82'\"],\n                [\"t\", \"'keydown-84'\"],\n                [\"y\", \"'keydown-89'\"],\n                [\"u\", \"'keydown-85'\"],\n                [\"i\", \"'keydown-73'\"],\n                [\"o\", \"'keydown-79'\"],\n                [\"p\", \"'keydown-80'\"],\n                [\"a\", \"'keydown-65'\"],\n                [\"s\", \"'keydown-83'\"],\n                [\"d\", \"'keydown-68'\"],\n                [\"f\", \"'keydown-70'\"],\n                [\"g\", \"'keydown-71'\"],\n                [\"h\", \"'keydown-72'\"],\n                [\"j\", \"'keydown-74'\"],\n                [\"k\", \"'keydown-75'\"],\n                [\"l\", \"'keydown-76'\"],\n                [\"z\", \"'keydown-90'\"],\n                [\"x\", \"'keydown-88'\"],\n                [\"c\", \"'keydown-67'\"],\n                [\"v\", \"'keydown-86'\"],\n                [\"b\", \"'keydown-66'\"],\n                [\"n\", \"'keydown-78'\"],\n                [\"m\", \"'keydown-77'\"]\n            ]), \"dropdown\");\n        this.setInputsInline(true);\n        this.setOutput(true, 'event');\n        this.setTooltip('');\n    }\n};\n\nBlockly.JavaScript.key_pressed = function() {\n    var dropdown_dropdown = this.getTitleValue('dropdown');\n    // TODO: Assemble JavaScript into code variable.\n    var code = dropdown_dropdown;\n    // TODO: Change ORDER_NONE to the correct strength.\n    return [code, Blockly.JavaScript.ORDER_NONE];\n};\n\ncustom.ball_at = {\n    helpUrl: '../../../../blocks_API/generic_event_help.html?event=Ball_at',\n    init: function() {\n        this.setColour(190);\n        this.appendDummyInput()\n            .appendTitle(\"Ball at\");\n        this.appendDummyInput()\n            .appendTitle(new Blockly.FieldDropdown([\n                [\"left\", \"'ballAtLeft'\"],\n                [\"right\", \"'ballAtRight'\"],\n                [\"top\", \"'ballAtTop'\"],\n                [\"bottom\", \"'ballAtBottom'\"]\n            ]), \"menu\");\n        this.setInputsInline(true);\n        this.setOutput(true, 'event');\n        this.setTooltip('');\n    }\n};\n\nBlockly.JavaScript.ball_at = function() {\n    var dropdown_menu = this.getTitleValue('menu');\n    // TODO: Assemble JavaScript into code variable.\n    var code = dropdown_menu;\n    // TODO: Change ORDER_NONE to the correct strength.\n    return [code, Blockly.JavaScript.ORDER_NONE];\n};\n\ncustom.ball_collides_with = {\n    helpUrl: '../../../../blocks_API/ball_colliades.html',\n    init: function() {\n        this.setColour(190);\n        this.appendDummyInput()\n            .appendTitle(\"Ball collides with \");\n        this.appendDummyInput()\n            .appendTitle(new Blockly.FieldDropdown([\n                [\"red\", \"'ballCollidesWithRedBrick'\"],\n                [\"gold\", \"'ballCollidesWithGoldBrick'\"],\n                [\"green\", \"'ballCollidesWithGreenBrick'\"],\n                [\"blue\", \"'ballCollidesWithBlueBrick'\"],\n                [\"pink\", \"'ballCollidesWithPinkBrick'\"],\n                [\"any color\", \"'ballCollidesWithBrick'\"]\n            ]), \"menu\")\n        this.appendDummyInput()\n            .appendTitle(\" brick\");\n        this.setInputsInline(true);\n        this.setOutput(true, 'event');\n        this.setTooltip('');\n    }\n};\n\nBlockly.JavaScript.ball_collides_with = function() {\n    var dropdown_menu = this.getTitleValue('menu');\n    // TODO: Assemble JavaScript into code variable.\n    var code = dropdown_menu;\n    // TODO: Change ORDER_NONE to the correct strength.\n    return [code, Blockly.JavaScript.ORDER_NONE];\n};\n\ncustom.ballHitPad = {\n    helpUrl: '../../../../blocks_API/generic_event_help.html?event=Ball_hit_pad',\n    init: function() {\n        this.setColour(190);\n        this.appendDummyInput()\n            .appendTitle(\"Ball hit pad\");\n        this.setOutput(true, 'event');\n        this.setTooltip('Ball hit pad');\n    }\n};\n\nBlockly.JavaScript.ballHitPad = function() {\n    return ['\"ballHitPad\"', Blockly.JavaScript.ORDER_NONE];\n};\n\n\ncustom.ballHitsBrick = {\n    helpUrl: '../../../../blocks_API/ball_hits_a_brick.html',\n    init: function() {\n        this.setColour(190);\n        this.appendDummyInput()\n            .appendTitle(\"Ball hits \");\n        this.appendDummyInput()\n            .appendTitle(new Blockly.FieldDropdown([\n                [\"any edge\", \"'ballCollidesWithBrick'\"],\n                [\"a wide edge\", \"'wideEdgeCollisionOfBallAndBrick'\"],\n                [\"a narrow edge\", \"'narrowEdgeCollisionOfBallAndBrick'\"]\n            ]), \"menu\")\n        this.appendDummyInput()\n        .appendTitle(\"of the brick\");\n        this.setInputsInline(true);\n        this.setOutput(true, \"event\");\n        this.setTooltip('');\n    }\n};\n\n\nBlockly.JavaScript.ballHitsBrick = function() {\n    var dropdown_menu = this.getTitleValue('menu');\n    var code = dropdown_menu;\n    return [code, Blockly.JavaScript.ORDER_NONE];\n};\n\ncustom.noMoreBricks = {\n    helpUrl: '../../../../blocks_API/generic_event_help.html?event=No_more_bricks',\n    init: function() {\n        this.setColour(190);\n        this.appendDummyInput()\n            .appendTitle(\"No more bricks\");\n        this.setOutput(true, 'event');\n        this.setTooltip('No more bricks event');\n    }\n};\n\nBlockly.JavaScript.noMoreBricks = function() {\n    return ['\"noMoreBricks\"', Blockly.JavaScript.ORDER_NONE];\n};"
        };
    } else if (tVersion == "2") {
        this.project = {
            blocks:'<xml xmlns="http://www.w3.org/1999/xhtml"><block type="bp_repeat_forever" x="-104" y="-1381"><statement name="DO"><block type="bp_bsync" inline="true"><value name="WAIT-FOR"><block type="key_pressed"><title name="dropdown">\'keydown-37\'</title></block></value><next><block type="bp_bsync" inline="true"><value name="REQUEST"><block type="acceleratePad"><title name="menu">\'acceleratePadLeft\'</title></block></value><next><block type="bp_bsync" inline="true"><value name="REQUEST"><block type="acceleratePad"><title name="menu">\'acceleratePadLeft\'</title></block></value></block></next></block></next></block></statement></block><block type="bp_repeat_forever" x="-754" y="-1377"><statement name="DO"><block type="bp_bsync" inline="true"><value name="WAIT-FOR"><block type="key_pressed"><title name="dropdown">\'keydown-32\'</title></block></value><next><block type="bp_bsync" inline="true"><value name="REQUEST"><block type="startGame"></block></value></block></next></block></statement></block><block type="bp_repeat_forever" x="-756" y="-1257"><statement name="DO"><block type="bp_bsync" inline="true"><value name="WAIT-FOR"><block type="ball_at"><title name="menu">\'ballAtTop\'</title></block></value><next><block type="bp_bsync" inline="true"><value name="REQUEST"><block type="reverse_direction"><title name="menu">\'reverseBallYDirection\'</title></block></value></block></next></block></statement></block><block type="bp_repeat_forever" x="-103" y="-1209"><statement name="DO"><block type="bp_bsync" inline="true"><value name="WAIT-FOR"><block type="key_pressed"><title name="dropdown">\'keydown-39\'</title></block></value><next><block type="bp_bsync" inline="true"><value name="REQUEST"><block type="acceleratePad"><title name="menu">\'acceleratePadRight\'</title></block></value><next><block type="bp_bsync" inline="true"><value name="REQUEST"><block type="acceleratePad"><title name="menu">\'acceleratePadRight\'</title></block></value></block></next></block></next></block></statement></block><block type="bp_repeat_forever" x="-748" y="-1121"><statement name="DO"><block type="bp_bsync" inline="true"><value name="WAIT-FOR"><block type="ball_at"><title name="menu">\'ballAtLeft\'</title></block></value><next><block type="bp_bsync" inline="true"><value name="REQUEST"><block type="reverse_direction"><title name="menu">\'reverseBallXDirection\'</title></block></value></block></next></block></statement></block><block type="bp_repeat_forever" x="-105" y="-1035"><statement name="DO"><block type="bp_bsync" inline="true"><value name="WAIT-FOR"><block type="ballHitPad"></block></value><next><block type="bp_bsync" inline="true"><value name="REQUEST"><block type="reverse_direction"><title name="menu">\'reverseBallYDirection\'</title></block></value><next><block type="bp_bsync" inline="true"><value name="REQUEST"><block type="changeXSpeedRelativeToPad"></block></value></block></next></block></next></block></statement></block><block type="bp_repeat_forever" x="-746" y="-996"><statement name="DO"><block type="bp_bsync" inline="true"><value name="WAIT-FOR"><block type="ball_at"><title name="menu">\'ballAtRight\'</title></block></value><next><block type="bp_bsync" inline="true"><value name="REQUEST"><block type="reverse_direction"><title name="menu">\'reverseBallXDirection\'</title></block></value></block></next></block></statement></block><block type="bp_repeat_forever" x="-752" y="-862"><statement name="DO"><block type="bp_bsync" inline="true"><value name="WAIT-FOR"><block type="ball_at"><title name="menu">\'ballAtBottom\'</title></block></value><next><block type="bp_bsync" inline="true"><value name="REQUEST"><block type="gameStatus"><title name="menu">\'gameLost\'</title></block></value></block></next></block></statement></block><block type="bp_repeat_forever" x="-107" y="-851"><statement name="DO"><block type="bp_bsync" inline="true"><value name="WAIT-FOR"><block type="ball_collides_with"><title name="menu">\'ballCollidesWithBrick\'</title></block></value><next><block type="bp_bsync" inline="true"><value name="REQUEST"><block type="destroyCurrentBricks"></block></value></block></next></block></statement></block><block type="bp_repeat_forever" x="-755" y="-737"><statement name="DO"><block type="bp_bsync" inline="true"><value name="WAIT-FOR"><block type="destroyCurrentBricks"></block></value><next><block type="bp_bsync" inline="true"><value name="REQUEST"><block type="increaseScore"></block></value></block></next></block></statement></block><block type="bp_repeat_forever" x="-105" y="-726"><statement name="DO"><block type="bp_bsync" inline="true"><value name="WAIT-FOR"><block type="ballHitsBrick"><title name="menu">\'narrowEdgeCollisionOfBallAndBrick\'</title></block></value><next><block type="bp_bsync" inline="true"><value name="REQUEST"><block type="reverse_direction"><title name="menu">\'reverseBallXDirection\'</title></block></value></block></next></block></statement></block><block type="bp_repeat_forever" x="-104" y="-589"><statement name="DO"><block type="bp_bsync" inline="true"><value name="WAIT-FOR"><block type="ballHitsBrick"><title name="menu">\'wideEdgeCollisionOfBallAndBrick\'</title></block></value><next><block type="bp_bsync" inline="true"><value name="REQUEST"><block type="reverse_direction"><title name="menu">\'reverseBallYDirection\'</title></block></value></block></next></block></statement></block></xml>',
            html_text: "<!DOCTYPE HTML>\n<html lang=\"fr\">\n<head>\n    <meta charset=\"UTF-8\">\n    <script type=\"text/javascript;version=1.7\">\n\t\tfunction windowLocation() {\n\t\t\tvar tProtocol = window.location.protocol;\n\t\t\tif((tProtocol == 'http:') || (tProtocol == 'http:')) {\n\t\t\t\treturn \"web\";\n\t\t\t}\n\t\t\telse if(tProtocol == 'file:') {\n\t\t\t\treturn \"file\";\n\t\t\t}\n\t\t};\n\t</script>\n\t<script type=\"text/javascript;version=1.7\">\n\t\tif(windowLocation() == \"web\") {\n\t\t\tdocument.write(\"<link id=\\\"linkToStyle\\\" href=\\\"\\/static\\/apps\\/BP_Code\\/apps\\/BP\\/examples\\/Bricks\\/styles.css\\\" rel=\\\"stylesheet\\\">\");\n\t\t}\n\t\telse {\n\t\t\tdocument.write(\"<link id=\\\"linkToStyle\\\" href=\\\"examples\\\\Bricks\\\\styles.css\\\" rel=\\\"stylesheet\\\">\");\n\t\t}\n\t</script>\n    <title>BrikBrok - my brick breaker HTML 5</title>\n</head>\n<body>\n    <div class=\"grid\">\n        <header>\n            <h1>\n                BP BrikBrok\n\t\t\t</h1>\n            <ul>\n                <li><a href=\"#gameZone\" id=\"newGame\" style=\"margin-right:25px\">New game</a></li>\n\t\t\t\t<li style=\"display:none;\"><a href=\"#gameZone\" id=\"wormHole\" style=\"display:none;\">Wormhole Mode</a></li>\n            </ul>\n        </header>\n        <div id=\"gameZone\">\n            <canvas id=\"backgroundCanvas\">\n                Your browser doesn't support HTML5. \n            </canvas>\n            <svg id=\"svgRoot\">\n\t\t\t\t<circle cx=\"100\" cy=\"50\" r=\"10\" id=\"ball\" />\n                <rect id=\"pad\" height=\"15px\" width=\"225px\" x=\"200\" y=\"150\" rx=\"10\" ry=\"20\"/>\n            </svg>\n            <div id=\"stats\">\n            </div>\n            <div id=\"message\">Victory!</div>\n        </div>\n        <footer>\n            <div style=\"height: 50px;width=100%\">\n\t\t\t\t<div style=\"float:left; width=33%; \">\n\t\t\t\t\t<h2 style=\"margin-left:15px\">Based on a tutorial by David Catuhe</h2>\n\t\t\t\t</div>\n\t\t\t\t<div id=\"scoreDiv\" style=\"float:left; width=33%; margin-left:32%;\">\n\t\t\t\t\t<h2 id=\"scoreTextZone\" style=\"font-size: 175%; color:black;\">Score:  0 </h2>\n\t\t\t\t</div>\n\t\t\t\t<div id=\"debugTextDiv\" style=\"float:right; width=33%; margin-right:5px; \">\n\t\t\t\t\t<h2 id=\"debugTextZone\" style=\"font-size: 150%; color:grey;\">Text will appear here</h2>\n\t\t\t\t</div>\n\t\t\t\t<!--border-style:solid; border-width: 2px;-->\n\t\t\t\t<!--<div style=\"float:left;\">\n\t\t\t\t\t<h2 style=\"margin-left:15px\">Based on a tutorial by David Catuhe</h2>\n\t\t\t\t</div>\n\t\t\t\t<div id=\"scoreDiv\" style=\"float:left; margin-left:30%; height:100px; width 100px; border-style:solid; border-width: 2px;\">\n\t\t\t\t\t<h2 id=\"scoreTextZone\" style=\"float:left;font-size: 175%; color:black;\">Score: </h2>\n\t\t\t\t\t<h2 id=\"scoreTextZone2\" style=\"float:left;font-size: 175%; color:black;\"> 0 </h2>\n\t\t\t\t</div>\n\t\t\t\t<div id=\"debugTextDiv\" style=\"float:left; margin-left:35%; height:100px; \">\n\t\t\t\t\t<h2 id=\"debugTextZone\" style=\"font-size: 150%; color:grey;text-align:center;\">Debug text will appear here</h2>\n\t\t\t\t</div>-->\n\t\t\t</div>\n\t\t</footer>\n    </div>\n\t<script type=\"text/javascript;version=1.7\" src=\"/static/apps/BP_Code/apps/BP/examples/Bricks/mouse.js\"></script>\n    <script type=\"text/javascript;version=1.7\" src=\"/static/apps/BP_Code/apps/BP/examples/Bricks/background.js\"></script>\n    <script type=\"text/javascript;version=1.7\" src=\"/static/apps/BP_Code/apps/BP/examples/Bricks/game.js\"></script>\n\t<script type=\"text/javascript;version=1.7\" src=\"examples\\Bricks\\mouse.js\"></script>\n    <script type=\"text/javascript;version=1.7\" src=\"examples\\Bricks\\background.js\"></script>\n    <script type=\"text/javascript;version=1.7\" src=\"examples\\Bricks\\game.js\"></script>\n</body>\n</html>\n",
            project_blocks: "custom = {};\n\ncustom.startGame = {\n    helpUrl: '../../../../blocks_API/generic_event_help.html?event=Start_game',\n    init: function() {\n        this.setColour(230);\n        this.appendDummyInput()\n            .appendTitle(\"Start game\");\n        this.setOutput(true, 'event');\n        this.setTooltip('Start game event');\n    }\n};\n\nBlockly.JavaScript.startGame = function() {\n    return ['\"startGame\"', Blockly.JavaScript.ORDER_NONE];\n};\n//Currently not working - debug.\n/*\ncustom.initialConfiguration = {\n  //helpUrl: 'http://www.example.com/',\n  init: function() {\n    this.setColour(230);\n    this.appendDummyInput()\n        .appendTitle(\"Board of\");\n    this.appendDummyInput()\n        .appendTitle(new Blockly.FieldDropdown([[\"5*20\", \"5 20\"], [\"5*5\", \"5 5\"], [\"3*3\", \"33\"]]), \"board_size\");\n    this.appendDummyInput()\n        .appendTitle(\"with \");\n    this.appendDummyInput()\n        .appendTitle(new Blockly.FieldTextInput(\"5\"), \"num_of_red_bricks\");\n    this.appendDummyInput()\n        .appendTitle(\"red, \");\n    this.appendDummyInput()\n        .appendTitle(new Blockly.FieldTextInput(\"5\"), \"num_of_gold_bricks\");\n    this.appendDummyInput()\n        .appendTitle(\"gold, \");\n    this.appendDummyInput()\n        .appendTitle(new Blockly.FieldTextInput(\"5\"), \"num_of_green_bricks\");\n    this.appendDummyInput()\n        .appendTitle(\"green, \");\n    this.appendDummyInput()\n        .appendTitle(new Blockly.FieldTextInput(\"5\"), \"num_of_blue_bricks\");\n    this.appendDummyInput()\n        .appendTitle(\"blue, and\");\n    this.appendDummyInput()\n        .appendTitle(new Blockly.FieldTextInput(\"5\"), \"num_of_pink_bricks\");\n    this.appendDummyInput()\n    .appendTitle(\"pink bricks.\");\n    this.setInputsInline(true);\n    this.setOutput(true, 'event');\n    this.setTooltip('');\n  }\n};\n\nBlockly.JavaScript.initialConfiguration = function() {\n  var dropdown_board_size = this.getTitleValue('board_size');\n  var text_num_of_red_bricks = this.getTitleValue('num_of_red_bricks');\n  var text_num_of_gold_bricks = this.getTitleValue('num_of_gold_bricks');\n  var text_num_of_green_bricks = this.getTitleValue('num_of_green_bricks');\n  var text_num_of_blue_bricks = this.getTitleValue('num_of_blue_bricks');\n  var text_num_of_pink_bricks = this.getTitleValue('num_of_pink_bricks');\n  var code = \"\";\n  //var code =    'board_size:' + dropdown_board_size + ',' + 'num_of_red_bricks:' + text_num_of_red_bricks + ',' + 'num_of_gold_bricks:' + text_num_of_gold_bricks + ',' +  'num_of_green_bricks:' + text_num_of_green_bricks + ',' +  'num_of_blue_bricks:' + text_num_of_blue_bricks + ',' +  'num_of_pink_bricks:' + text_num_of_pink_bricks;\n  return [code, Blockly.JavaScript.ORDER_NONE];\n};\n*/\ncustom.acceleratePad = {\n    helpUrl: '../../../../blocks_API/generic_event_help.html?event=Accelerate_pad',\n    init: function() {\n        this.setColour(230);\n        this.appendDummyInput()\n            .appendTitle(\"Accelerate pad\");\n        this.appendDummyInput()\n            .appendTitle(new Blockly.FieldDropdown([\n                [\"left\", \"'acceleratePadLeft'\"],\n                [\"right\", \"'acceleratePadRight'\"]\n            ]), \"menu\");\n        this.setInputsInline(true);\n        this.setOutput(true, 'event');\n        this.setTooltip('');\n    }\n};\n\nBlockly.JavaScript.acceleratePad = function() {\n    var dropdown_menu = this.getTitleValue('menu');\n    // TODO: Assemble JavaScript into code variable.\n    var code = dropdown_menu;\n    // TODO: Change ORDER_NONE to the correct strength.\n    return [code, Blockly.JavaScript.ORDER_NONE];\n};\n\ncustom.color_brick = {\n    helpUrl: '../../../../blocks_API/generic_event_help.html?event=Color_brick',\n    init: function() {\n        this.setColour(230);\n        this.appendDummyInput()\n            .appendTitle(\"Color brick \");\n        this.appendDummyInput()\n            .appendTitle(new Blockly.FieldDropdown([\n                [\"green\", \"'colorBrickGreen'\"],\n                [\"gold\", \"'colorBrickGold'\"],\n                [\"blue\", \"'colorBrickBlue'\"],\n                [\"red\", \"'colorBrickRed'\"]\n            ]), \"menu\");\n        this.setInputsInline(true);\n        this.setOutput(true, 'event');\n        this.setTooltip('');\n    }\n};\n\nBlockly.JavaScript.color_brick = function() {\n    var dropdown_menu = this.getTitleValue('menu');\n    // TODO: Assemble JavaScript into code variable.\n    var code = dropdown_menu;\n    // TODO: Change ORDER_NONE to the correct strength.\n    return [code, Blockly.JavaScript.ORDER_NONE];\n};\n\ncustom.reverse_direction = {\n    helpUrl: '../../../../blocks_API/generic_event_help.html?event=Reverse_ball',\n    init: function() {\n        this.setColour(230);\n        this.appendDummyInput()\n            .appendTitle(\"Reverse ball\");\n        this.appendDummyInput()\n            .appendTitle(new Blockly.FieldDropdown([\n                [\"x\", \"'reverseBallXDirection'\"],\n                [\"y\", \"'reverseBallYDirection'\"]\n            ]), \"menu\");\n        this.appendDummyInput()\n            .appendTitle(\"direction\");\n        this.setInputsInline(true);\n        this.setOutput(true, \"event\");\n        this.setTooltip('');\n    }\n};\n\nBlockly.JavaScript.reverse_direction = function() {\n    var dropdown_menu = this.getTitleValue('menu');\n    // TODO: Assemble JavaScript into code variable.\n    var code = dropdown_menu;\n    // TODO: Change ORDER_NONE to the correct strength.\n    return [code, Blockly.JavaScript.ORDER_NONE];\n};\n\ncustom.destroyCurrentBricks = {\n    helpUrl: '../../../../blocks_API/generic_event_help.html?event=Destroy_brick',\n    init: function() {\n        this.setColour(230);\n        this.appendDummyInput()\n            .appendTitle(\"Destroy brick\");\n        this.setOutput(true, 'event');\n        this.setTooltip('Destroy current bricks');\n    }\n};\n\nBlockly.JavaScript.destroyCurrentBricks = function() {\n    return ['\"destroyCurrentBricks\"', Blockly.JavaScript.ORDER_NONE];\n};\n\ncustom.changeXSpeedRelativeToPad = {\n    helpUrl: '../../../../blocks_API/generic_event_help.html?event=Change_x_speed',\n    init: function() {\n        this.setColour(230);\n        this.appendDummyInput()\n            .appendTitle(\"Change x speed relative to pad\");\n        this.setOutput(true, 'event');\n        this.setTooltip('Change x speed relative to pad');\n    }\n};\n\nBlockly.JavaScript.changeXSpeedRelativeToPad = function() {\n    return ['\"changeXSpeedRelativeToPad\"', Blockly.JavaScript.ORDER_NONE];\n};\n\ncustom.increaseScore = {\n    helpUrl: '../../../../blocks_API/generic_event_help.html?event=Increase_score',\n    init: function() {\n        this.setColour(230);\n        this.appendDummyInput()\n            .appendTitle(\"Increase score\");\n        this.setOutput(true, 'event');\n        this.setTooltip('Increase score event');\n    }\n};\n\nBlockly.JavaScript.increaseScore = function() {\n    return ['\"increaseScore\"', Blockly.JavaScript.ORDER_NONE];\n};\n\ncustom.decreaseScore = {\n    helpUrl: '../../../../blocks_API/generic_event_help.html?event=Decrease_score',\n    init: function() {\n        this.setColour(230);\n        this.appendDummyInput()\n            .appendTitle(\"Decrease score\");\n        this.setOutput(true, 'event');\n        this.setTooltip('Decrease score event');\n    }\n};\n\nBlockly.JavaScript.decreaseScore = function() {\n    return ['\"decreaseScore\"', Blockly.JavaScript.ORDER_NONE];\n};\n\ncustom.initScore = {\n    helpUrl: '../../../../blocks_API/generic_event_help.html?event=Init_score',\n    init: function() {\n        this.setColour(230);\n        this.appendDummyInput()\n            .appendTitle(\"Init score\");\n        this.setOutput(true, 'event');\n        this.setTooltip('Init score event');\n    }\n};\n\nBlockly.JavaScript.initScore = function() {\n    return ['\"initScore\"', Blockly.JavaScript.ORDER_NONE];\n};\n\ncustom.gameStatus = {\n    helpUrl: '../../../../blocks_API/game_status.html',\n    init: function() {\n        this.setColour(230);\n        this.appendDummyInput()\n            .appendTitle(\"Game \");\n        this.appendDummyInput()\n            .appendTitle(new Blockly.FieldDropdown([\n                [\"lost\", \"'gameLost'\"],\n                [\"won\", \"'gameWon'\"],\n            ]), \"menu\");\n        this.setInputsInline(true);\n        this.setOutput(true, 'event');\n        this.setTooltip('');\n    }\n};\n\nBlockly.JavaScript.gameStatus = function() {\n    var dropdown_menu = this.getTitleValue('menu');\n    // TODO: Assemble JavaScript into code variable.\n    var code = dropdown_menu;\n    // TODO: Change ORDER_NONE to the correct strength.\n    return [code, Blockly.JavaScript.ORDER_NONE];\n};\n\n\ncustom.showVictoryMessage = {\n    helpUrl: '../../../../blocks_API/generic_event_help.html?event=Show_victory__message',\n    init: function() {\n        this.setColour(230);\n        this.appendDummyInput()\n            .appendTitle(\"Show victory message\");\n        this.setOutput(true, 'event');\n        this.setTooltip('Show victory message event');\n    }\n};\n\nBlockly.JavaScript.showVictoryMessage = function() {\n    return ['\"showVictoryMessage\"', Blockly.JavaScript.ORDER_NONE];\n};\n\ncustom.key_pressed = {\n    helpUrl: '../../../../blocks_API/clicked_event.html',\n    init: function() {\n        this.setColour(190);\n        this.appendDummyInput()\n            .appendTitle(\"Clicked\");\n        this.appendDummyInput()\n            .appendTitle(new Blockly.FieldDropdown([\n                [\"space\", \"'keydown-32'\"],\n                [\"key left\", \"'keydown-37'\"],\n                [\"key right\", \"'keydown-39'\"],\n                [\"key up\", \"'keydown-38'\"],\n                [\"key down\", \"'keydown-40'\"],\n                [\"enter\", \"'keydown-13'\"],\n                /*\n                [\"escape\", \"'keydown-27'\"],\n                [\"backspace\", \"'keydown-8'\"],\n                [\"ctrl\", \"'keydown-17'\"],\n                [\"alt\", \"'keydown-18'\"],\n                [\"shift\", \"'keydown-16'\"],\n                [\"caps-lock\", \"'keydown-20'\"],\n                [\"tab\", \"'keydown-9'\"],\n                [\"\\\\\", \"'keydown-220'\"],\n                [\"`\", \"'keydown-192'\"],\n                [\"[\", \"'keydown-219'\"],\n                [\"\\'\", \"'keydown-220'\"],\n                [\"]\", \"'keydown-221'\"],\n                [\";\", \"'keydown-59'\"],\n                [\",\", \"'keydown-188'\"],\n                [\".\", \"'keydown-190'\"],\n                [\"/\", \"'keydown-191'\"],\n                [\"-\", \"'keydown-173'\"],\n                [\"=\", \"'keydown-61'\"],\n                [\"=\", \"'keydown-61'\"],\n                */\n                [\"1\", \"'keydown-49'\"],\n                [\"2\", \"'keydown-50'\"],\n                [\"3\", \"'keydown-51'\"],\n                [\"4\", \"'keydown-52'\"],\n                [\"5\", \"'keydown-53'\"],\n                [\"6\", \"'keydown-54'\"],\n                [\"7\", \"'keydown-55'\"],\n                [\"8\", \"'keydown-56'\"],\n                [\"9\", \"'keydown-57'\"],\n                [\"q\", \"'keydown-81'\"],\n                [\"w\", \"'keydown-87'\"],\n                [\"e\", \"'keydown-69'\"],\n                [\"r\", \"'keydown-82'\"],\n                [\"t\", \"'keydown-84'\"],\n                [\"y\", \"'keydown-89'\"],\n                [\"u\", \"'keydown-85'\"],\n                [\"i\", \"'keydown-73'\"],\n                [\"o\", \"'keydown-79'\"],\n                [\"p\", \"'keydown-80'\"],\n                [\"a\", \"'keydown-65'\"],\n                [\"s\", \"'keydown-83'\"],\n                [\"d\", \"'keydown-68'\"],\n                [\"f\", \"'keydown-70'\"],\n                [\"g\", \"'keydown-71'\"],\n                [\"h\", \"'keydown-72'\"],\n                [\"j\", \"'keydown-74'\"],\n                [\"k\", \"'keydown-75'\"],\n                [\"l\", \"'keydown-76'\"],\n                [\"z\", \"'keydown-90'\"],\n                [\"x\", \"'keydown-88'\"],\n                [\"c\", \"'keydown-67'\"],\n                [\"v\", \"'keydown-86'\"],\n                [\"b\", \"'keydown-66'\"],\n                [\"n\", \"'keydown-78'\"],\n                [\"m\", \"'keydown-77'\"]\n            ]), \"dropdown\");\n        this.setInputsInline(true);\n        this.setOutput(true, 'event');\n        this.setTooltip('');\n    }\n};\n\nBlockly.JavaScript.key_pressed = function() {\n    var dropdown_dropdown = this.getTitleValue('dropdown');\n    // TODO: Assemble JavaScript into code variable.\n    var code = dropdown_dropdown;\n    // TODO: Change ORDER_NONE to the correct strength.\n    return [code, Blockly.JavaScript.ORDER_NONE];\n};\n\ncustom.ball_at = {\n    helpUrl: '../../../../blocks_API/generic_event_help.html?event=Ball_at',\n    init: function() {\n        this.setColour(190);\n        this.appendDummyInput()\n            .appendTitle(\"Ball at\");\n        this.appendDummyInput()\n            .appendTitle(new Blockly.FieldDropdown([\n                [\"left\", \"'ballAtLeft'\"],\n                [\"right\", \"'ballAtRight'\"],\n                [\"top\", \"'ballAtTop'\"],\n                [\"bottom\", \"'ballAtBottom'\"]\n            ]), \"menu\");\n        this.setInputsInline(true);\n        this.setOutput(true, 'event');\n        this.setTooltip('');\n    }\n};\n\nBlockly.JavaScript.ball_at = function() {\n    var dropdown_menu = this.getTitleValue('menu');\n    // TODO: Assemble JavaScript into code variable.\n    var code = dropdown_menu;\n    // TODO: Change ORDER_NONE to the correct strength.\n    return [code, Blockly.JavaScript.ORDER_NONE];\n};\n\ncustom.ball_collides_with = {\n    helpUrl: '../../../../blocks_API/ball_colliades.html',\n    init: function() {\n        this.setColour(190);\n        this.appendDummyInput()\n            .appendTitle(\"Ball collides with \");\n        this.appendDummyInput()\n            .appendTitle(new Blockly.FieldDropdown([\n                [\"red\", \"'ballCollidesWithRedBrick'\"],\n                [\"gold\", \"'ballCollidesWithGoldBrick'\"],\n                [\"green\", \"'ballCollidesWithGreenBrick'\"],\n                [\"blue\", \"'ballCollidesWithBlueBrick'\"],\n                [\"pink\", \"'ballCollidesWithPinkBrick'\"],\n                [\"any color\", \"'ballCollidesWithBrick'\"]\n            ]), \"menu\")\n        this.appendDummyInput()\n            .appendTitle(\" brick\");\n        this.setInputsInline(true);\n        this.setOutput(true, 'event');\n        this.setTooltip('');\n    }\n};\n\nBlockly.JavaScript.ball_collides_with = function() {\n    var dropdown_menu = this.getTitleValue('menu');\n    // TODO: Assemble JavaScript into code variable.\n    var code = dropdown_menu;\n    // TODO: Change ORDER_NONE to the correct strength.\n    return [code, Blockly.JavaScript.ORDER_NONE];\n};\n\ncustom.ballHitPad = {\n    helpUrl: '../../../../blocks_API/generic_event_help.html?event=Ball_hit_pad',\n    init: function() {\n        this.setColour(190);\n        this.appendDummyInput()\n            .appendTitle(\"Ball hit pad\");\n        this.setOutput(true, 'event');\n        this.setTooltip('Ball hit pad');\n    }\n};\n\nBlockly.JavaScript.ballHitPad = function() {\n    return ['\"ballHitPad\"', Blockly.JavaScript.ORDER_NONE];\n};\n\n\ncustom.ballHitsBrick = {\n    helpUrl: '../../../../blocks_API/ball_hits_a_brick.html',\n    init: function() {\n        this.setColour(190);\n        this.appendDummyInput()\n            .appendTitle(\"Ball hits \");\n        this.appendDummyInput()\n            .appendTitle(new Blockly.FieldDropdown([\n                [\"any edge\", \"'ballCollidesWithBrick'\"],\n                [\"a wide edge\", \"'wideEdgeCollisionOfBallAndBrick'\"],\n                [\"a narrow edge\", \"'narrowEdgeCollisionOfBallAndBrick'\"]\n            ]), \"menu\")\n        this.appendDummyInput()\n        .appendTitle(\"of the brick\");\n        this.setInputsInline(true);\n        this.setOutput(true, \"event\");\n        this.setTooltip('');\n    }\n};\n\n\nBlockly.JavaScript.ballHitsBrick = function() {\n    var dropdown_menu = this.getTitleValue('menu');\n    var code = dropdown_menu;\n    return [code, Blockly.JavaScript.ORDER_NONE];\n};\n\ncustom.noMoreBricks = {\n    helpUrl: '../../../../blocks_API/generic_event_help.html?event=No_more_bricks',\n    init: function() {\n        this.setColour(190);\n        this.appendDummyInput()\n            .appendTitle(\"No more bricks\");\n        this.setOutput(true, 'event');\n        this.setTooltip('No more bricks event');\n    }\n};\n\nBlockly.JavaScript.noMoreBricks = function() {\n    return ['\"noMoreBricks\"', Blockly.JavaScript.ORDER_NONE];\n};"
        };
    }
	
	//allowing work with different testCase
	if(tTestCase != "0"){
        var stringToReplace = "game" + tTestCase + ".js"; 
		this.project.html_text = this.project.html_text.replace(/game.js/gi , stringToReplace);
	}
	
	
    this.prepareWorkspaceBlocks(false, this.project.blocks);
};

versionControllerCode.prototype.decodeHTML = function(input) {
    var e = document.createElement('div');
    e.innerHTML = input;
    var ans = e.childNodes.length === 0 ? "" : e.childNodes[0].nodeValue;
    return ans;
};

versionControllerCode.prototype.getScrollBarCoordinates = function() {

    var tAnswer;
    if ((typeof tVersion == 'undefined') || (tVersion == "1")) {
        tAnswer = [600, 400];
    } else if (tVersion == "2") {
        tAnswer = [650, 450];
    }
    return tAnswer;
};

/**
 * Template document load template.js or template.js
 */
versionControllerCode.prototype.getTemplateDocument = function() {
    return null;
};

/**
 * prepare localStorage ,true signals reset local storage no matter if it's initialized or not.
 */
versionControllerCode.prototype.prepareWorkspaceBlocks = function(flag, blocks) {
    if (!this.isStorageIntialized() || flag) {
        this.resetLocalStorage(blocks);
    } else {
        //this.restoreBlocksFromVersionController();
    }
};

//TODO: Consider removing this method
/**
 *
 * True signals reset localStorage anyway
 */
versionControllerCode.prototype.resetMembers = function(flag) {
    return null;
    /*if(!this.isStorageIntialized() || (!(typeof flag === "undefined") && flag)) {
		this.resetLocalStorage();
	}
	this.parent.resetMembers.call(this);
	*/
};

//TODO - Check if this method is being used, if not remove.
versionControllerCode.prototype.flagLocalStorageInitialized = function() {
    if ('localStorage' in window) {
        //Initialize flag for first time in localStorage
        window.localStorage.setItem("reset", tVersion /*"true"*/ );
    } else {
        console.log("No LocalStorage, Error resetting localstorage");
    }
};

//TODO - Check if this method is being used, if not remove.
versionControllerCode.prototype.isStorageIntialized = function() {
    var tAnswer = false;
    if ('localStorage' in window) {
        var tValue = window.localStorage.getItem("reset");
        if (tValue != null) { //Key is defined.
            if (tValue === tVersion /*"true"*/ ) {
                tAnswer = true;
            }
        } else {
            //console.log("'reset' value in localStorage is null");
        }
    } else {
        console.log("No LocalStorage, Error resetting localstorage");
    }
    return tAnswer;
};

versionControllerCode.prototype.resetLocalStorage = function(tXml) {
    //var tXml = null;
    var tKey = null;
    if ('localStorage' in window) {
        //Initialize flag for first time in localStorage
        //window.localStorage.setItem("reset", "");
        this.flagLocalStorageInitialized();

        //Initialize workspace localStorage
        //tXml = "";
        tKey = "workspace";
        window.localStorage.setItem(tKey, tXml);

        //Log backup test reset? TODO: Test
        tKey = "logText";
        if (window.localStorage.getItem("logText") == null) { //If not defined, define.
            window.localStorage.setItem(tKey, "");
        }

		this.resetVideoFlag();
    } else {
        console.log("No LocalStorage, Error resetting localstorage");
    }
};

/**
 * Backing up workspace changes to the local storage
 * Duplicate code for backing up BP Code workspace to the local storage.
 */
versionControllerCode.prototype.backUpWorkspaceBlocks = function() {

    //TODO: Do we need this code?
    //Mark that the values in the workspace have changed	
    //versionControllerCode.prototype.flagLocalStorageInitialized();

    //Perhaps check if there is a change between the xml before changing.
    var tXml = Blockly.Xml.workspaceToDom(Blockly.mainWorkspace); //XML representing the blocks in the workspace
    var tText = Blockly.Xml.domToText(tXml); //Translating this XML to text representation
    var tKey = "workspace";
    var current_XML_tree = window.localStorage.getItem(tKey);
    //var current_XML_tree = this.tVersionController[tKey];
    var updated_XML_tree;
    var current_XML_tree_parsed = current_XML_tree.split("<&>");
    //TODO: perhaps we save to much detail, perhaps only save the latest version of workspace??
    if (tText != current_XML_tree_parsed[current_XML_tree_parsed.length - 1]) //Check if current workspace is not already backed up.
    {
        updated_XML_tree = current_XML_tree + "<&>" + tText;
        window.localStorage.setItem(tKey, updated_XML_tree);
        //this.tVersionController[tKey] = updated_XML_tree;
    }
};

// TODO: Do we use this function?
versionControllerCode.prototype.restoreBlocksFromVersionController = function() {
    //var tXmlText = this["Level_" + Maze.LEVEL];
    var tXmlText = window.localStorage.getItem("workspace");
    //Extract last XML tree from the local storage.
    var tXmlTrees = tXmlText.split("<&>");
    var tXmlTextLastVersion = tXmlTrees[tXmlTrees.length - 1];
    if (tXmlTextLastVersion != null) {
        var tXml = Blockly.Xml.textToDom(tXmlTextLastVersion);
        // Clear the workspace to avoid merge.
        Blockly.mainWorkspace.clear();
        Blockly.Xml.domToWorkspace(Blockly.mainWorkspace, tXml);
    } else {
        console.log("Key value is null" + "workspace" + ", inside versionController.restoreBlocksFromVersionController");
    }
};

versionControllerCode.prototype.keyUpListener = function(e) {

    //if ((e.keyCode == 82) && (e.shiftKey)){// Shift + R - for reset localStorage
    this.prepareWorkspaceBlocks(true, this.project.blocks);
    //}

};

//Need to encode data such as this.
//name + '=' + encodeURIComponent(content) 
versionControllerCode.prototype.testPostRequest = function(data) {

   if(data != null){
        var dataToSend =  encodeURI(data);
        window.jQuery.post('/storage', {
                xml: dataToSend
            },
            function(data, status, xhr) {
                console.log(status);
                console.log(data);
            });
    }
};

//Data which is returned from the server
//imgxei
//New key - n6zn6r
versionControllerCode.prototype.testPostRequest2 = function() {

    window.jQuery.post('/storage', {
            key: "amw646"
        },
        function(data, status, xhr) {
            console.log(status);
            console.log(data);
            var decodedData = decodeURI(data);
            console.log(decodedData);
        });

};


versionControllerCode.prototype.showIntroductionVideo = function() {

    if ('localStorage' in window) {
        var tFlag = window.localStorage.getItem("showVideo");
        if ((tFlag == null) || (tFlag == "false")) {
            var url = "introPopUp.html";
            if (tVersion == "1") {
                url = url + "?ver=1";
            } else if (tVersion == "2") {
                url = url + "?ver=2";
            } else {
                url = url + "?ver=1";
            }
            var win = window.open(url, '_blank');
            if(win != null){
                win.focus();
                //Initialize flag for first time in localStorage
                window.localStorage.setItem("showVideo", "true");
            }
            else{
                console.log("win var is null, couldn't focus to it");        
            }
        }
    } else {
        console.log("No LocalStorage, Error resetting localstorage in showIntroductionVideo");
    }
};

versionControllerCode.prototype.clickedShowIntroductionVideo = function() {
	this.resetVideoFlag();
	this.showIntroductionVideo();
};

versionControllerCode.prototype.resetVideoFlag = function(){
	if ('localStorage' in window) {
 		window.localStorage.setItem("showVideo", "false");
    } else {
        console.log("No LocalStorage, Error resetting localstorage in resetVideoFlag");
    }
}
